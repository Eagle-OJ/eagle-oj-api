<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="problem">
    <insert id="insertProblem" parameterType="ProblemEntity" useGeneratedKeys="true" keyProperty="pid">
        INSERT INTO `problem` (owner, title, code_language, description,
                               input_format, output_format, difficult, samples, moderators, status, create_time) VALUES
        (#{owner}, #{title}, #{codeLanguage}, #{description},#{inputFormat}, #{outputFormat},
        #{difficult}, #{samples}, #{moderators}, #{status}, #{createTime})
    </insert>

    <select id="getProblemByPid" resultMap="problemResultMap">
        SELECT * from `problem` WHERE `pid` = #{pid}
    </select>

    <select id="getProblemTags" resultType="HashMap">
        SELECT tag_problem.tid, tag_problem.pid,tags.name, tags.used
        FROM tag_problem LEFT JOIN tags ON tag_problem.tid = tags.tid WHERE tag_problem.pid = #{pid}
    </select>

    <select id="getAllProblem" resultMap="problemResultMap">
        SELECT * FROM `problem`
    </select>

    <select id="getSharedProblems" resultMap="problemResultMap">
        SELECT * FROM problem WHERE status=2 ORDER BY pid ASC
    </select>

    <select id="getProblemsByUid" resultMap="problemResultMap">
        SELECT * FROM `problem` WHERE owner=#{uid} ORDER BY create_time DESC
    </select>

    <update id="updateProblemModerators">
        UPDATE problem SET moderators=#{moderators} WHERE pid=#{pid}
    </update>

    <update id="addProblemSubmitTimes">
        UPDATE `problem` SET `submit_times` = `submit_times` + 1 WHERE `pid` = #{pid}
    </update>

    <update id="addProblemAcceptTimes">
        UPDATE `problem` SET `accept_times` = `accept_times` + 1 WHERE `pid` = #{pid}
    </update>

    <update id="updateProblemDescription" parameterType="ProblemEntity">
        UPDATE `problem` SET `title`=#{title}, `description`=#{description}, `input_format`=#{inputFormat},
            `output_format`=#{outputFormat}, `samples`=#{samples}, `difficult`=#{difficult}
        WHERE `pid`=#{pid}
    </update>

    <resultMap id="problemResultMap" type="ProblemEntity">
        <id column="pid" property="pid"/>
        <result column="owner" property="owner"/>
        <result column="title" property="title"/>
        <result column="code_language" property="codeLanguage"/>
        <result column="description" property="description"/>
        <result column="input_format" property="inputFormat"/>
        <result column="output_format" property="outputFormat"/>
        <result column="samples" property="samples"/>
        <result column="moderators" property="moderators"/>
        <result column="submit_times" property="submitTimes"/>
        <result column="used_times" property="usedTimes"/>
        <result column="ac_times" property="ACTimes"/>
        <result column="wa_times" property="WATimes"/>
        <result column="rte_times" property="RTETimes"/>
        <result column="tle_times" property="TLETimes"/>
        <result column="ce_times" property="CETimes"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
    </resultMap>
</mapper>
