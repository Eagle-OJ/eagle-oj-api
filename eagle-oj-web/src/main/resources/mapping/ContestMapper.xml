<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eagleoj.web.dao.ContestMapper">

        <insert id="save" parameterType="ContestEntity" useGeneratedKeys="true" keyProperty="cid">
            INSERT INTO `contest`(`name`,`owner`,`slogan`,`description`,`start_time`,
            `end_time`,`total_time`,`password`,`official`,`type`,`status`,`create_time`)
            VALUES (#{name},#{owner},#{slogan},#{description},#{startTime},
            #{endTime},#{totalTime},#{password},#{official},#{type},#{status},#{createTime})
        </insert>

        <select id="listValid" resultType="HashMap">
            SELECT
                contest.*,
                user.nickname
            FROM `contest`
                LEFT JOIN user ON contest.owner=user.uid
            WHERE status!=0 ORDER BY status ASC, official DESC, create_time DESC
        </select>

        <select id="listByUid" resultMap="contestMap">
            SELECT * FROM contest WHERE owner = #{uid} ORDER BY create_time DESC
        </select>

        <delete id="deleteByCid">
            DELETE FROM `contest` WHERE `cid` = #{cid}
        </delete>

        <update id="updateDescriptionByCid">
            UPDATE `contest` SET
                `name` = #{data.name},
                `slogan` = #{data.slogan},
                `description` = #{data.description},
                `start_time` = #{data.startTime},
                `end_time` = #{data.endTime},
                `total_time` = #{data.totalTime},
                `password` = #{data.password},
                `type` = #{data.type},
                `status`=0
            WHERE `cid` = #{cid}
        </update>

        <update id="updateStatusByCid">
            UPDATE contest SET status=#{status} WHERE cid=#{cid}
        </update>

        <select id="getByCid" resultMap="contestMap">
            SELECT * FROM `contest` WHERE `cid` = #{cid}
        </select>

        <resultMap id="contestMap" type="ContestEntity">
            <id column="cid" property="cid"/>
            <result column="name" property="name"/>
            <result column="owner" property="owner"/>
            <result column="slogan" property="slogan"/>
            <result column="description" property="description"/>
            <result column="start_time" property="startTime"/>
            <result column="end_time" property="endTime"/>
            <result column="total_time" property="totalTime"/>
            <result column="password" property="password"/>
            <result column="official" property="official"/>
            <result column="type" property="type"/>
            <result column="status" property="status"/>
            <result column="create_time" property="createTime"/>
        </resultMap>
</mapper>